# PRF - Plano de Requisi√ß√£o de Funcionalidade

## T√≠tulo
Refatora√ß√£o, Seguran√ßa e Finaliza√ß√£o de Funcionalidades do Sistema Escolar

---

## Objetivo
Consolidar e finalizar as principais funcionalidades do sistema escolar, garantindo seguran√ßa, modularidade, facilidade de manuten√ß√£o e experi√™ncia do usu√°rio, com foco em:

- Seguran√ßa de credenciais e regras do banco
- Finaliza√ß√£o do fluxo de exclus√£o de usu√°rios (Auth + DB)
- Refatora√ß√£o de componentes grandes para subcomponentes reutiliz√°veis
- Regras de neg√≥cio para per√≠odos escolares
- Melhoria de UX e feedbacks
- Estrutura√ß√£o para testes e auditoria

---

## Escopo

### 1. Seguran√ßa
- Remover arquivo de service account do reposit√≥rio e adicionar ao `.gitignore`
- Revisar e refor√ßar regras do Realtime Database
- Orientar uso seguro de credenciais em produ√ß√£o

### 2. Cloud Functions
- Recriar pasta `functions/` em TypeScript
- Adicionar fun√ß√£o `deleteUser` (exclus√£o Auth + DB)
- Ajustar scripts de lint/predeploy para deploy sem erros

### 3. Gest√£o Escolar
- Refatorar `escola/page.jsx` em subcomponentes: TurmaList, PeriodoManager, AvisosBoard, etc.
- Garantir unicidade de per√≠odo ativo por ano (se aplic√°vel)
- Impedir exclus√£o de per√≠odo vinculado a turma
- Exibir status de uso de per√≠odos

### 4. Experi√™ncia do Usu√°rio
- Substituir `alert` por toasts/snackbars
- Adicionar feedback visual em bot√µes (loading, sucesso, erro)
- Confirma√ß√£o ao editar/excluir dados sens√≠veis

### 5. Auditoria e Testes
- Adicionar campos `createdAt`, `updatedAt`, `createdBy` em entidades principais
- Estruturar diret√≥rio `services/` para l√≥gica de acesso ao banco
- Iniciar testes unit√°rios de helpers e servi√ßos

---

## Crit√©rios de Aceite
- Nenhum arquivo de credencial sens√≠vel no reposit√≥rio
- Exclus√£o de usu√°rio remove do Auth e do DB via fun√ß√£o backend
- N√£o √© poss√≠vel excluir per√≠odo vinculado a turma
- Refatora√ß√£o modular de pelo menos 2 grandes componentes
- Feedback visual em todas as a√ß√µes cr√≠ticas
- Regras do banco impedem escrita/leitura n√£o autorizada
- Teste unit√°rio b√°sico rodando para pelo menos um helper

---

## Prioridade
1. Seguran√ßa e Cloud Functions
2. Refatora√ß√£o modular e regras de neg√≥cio
3. UX e feedbacks
4. Auditoria e testes

---

## Observa√ß√µes
- O projeto j√° possui boa base de autentica√ß√£o, navega√ß√£o e CRUDs.
- A modulariza√ß√£o e seguran√ßa s√£o essenciais para escalar e manter o sistema.
- O roadmap pode ser ajustado conforme surgirem novas demandas.

---

# An√°lise de Funcionalidades e Melhorias para o Sistema Escolar

## Funcionalidades j√° implementadas

- **Gest√£o de Alunos**
  - Cadastro, edi√ß√£o e exclus√£o de alunos
  - Formul√°rio multi-etapas (dados pessoais, financeiros, anexos)
  - Upload e gerenciamento de anexos/documentos dos alunos
  - Visualiza√ß√£o e marca√ß√£o para exclus√£o de anexos
  - Filtros por turma, nome e matr√≠cula

- **Gest√£o de Turmas**
  - Cadastro e vincula√ß√£o de alunos a turmas
  - Visualiza√ß√£o de turmas

- **Gest√£o Financeira**
  - Controle de status financeiro do aluno (ativo/inadimplente)
  - Campos para valor de mensalidade, desconto, vencimento

- **Gest√£o de Usu√°rios do Sistema**
  - Cadastro, edi√ß√£o e exclus√£o de usu√°rios (coordenadora, professora, pai, inativo)
  - Aprova√ß√£o de novos usu√°rios
  - Filtro por tipo e por nome

- **Controle de Acesso**
  - Diferencia√ß√£o de permiss√µes por perfil (coordenadora, professora, pai)
  - Tela de acesso restrito

- **Alertas e Feedback Visual**
  - Mensagens de erro e alerta bem destacadas
  - Feedback visual para a√ß√µes importantes

---

## O que falta ou pode ser melhorado para uso real em escola

1. **Gest√£o de Professores e Funcion√°rios**
   - Cadastro e gerenciamento de professores e outros funcion√°rios
   - Vincula√ß√£o de professores a turmas e disciplinas

2. **Gest√£o de Disciplinas e Hor√°rios**
   - Cadastro de disciplinas/mat√©rias
   - Montagem de hor√°rios de aulas por turma e professor

3. **Lan√ßamento e Consulta de Notas/Frequ√™ncia**
   - Lan√ßamento de notas e faltas por disciplina
   - Consulta de boletim pelo respons√°vel/aluno

4. **Comunica√ß√£o Escola-Fam√≠lia**
   - Envio de avisos, comunicados e mensagens para respons√°veis
   - Hist√≥rico de comunicados

5. **Gest√£o de Matr√≠culas e Rematr√≠culas**
   - Processo de matr√≠cula e rematr√≠cula online
   - Controle de vagas por turma

6. **Relat√≥rios e Exporta√ß√µes**
   - Relat√≥rios de alunos por turma, inadimplentes, frequ√™ncia, notas etc.
   - Exporta√ß√£o para PDF/Excel

7. **Aprimoramento da Experi√™ncia do Usu√°rio**
   - Melhorias de usabilidade e acessibilidade
   - Layout responsivo para uso em celular/tablet
   - Ajuda/contexto para usu√°rios leigos

8. **Seguran√ßa e Auditoria**
   - Logs de a√ß√µes importantes (quem fez o qu√™ e quando)
   - Permiss√µes mais granulares (ex: s√≥ coordenadora pode excluir aluno)

9. **Integra√ß√£o com Pagamentos**
   - Integra√ß√£o com sistemas de cobran√ßa/boleto/pagamento online

10. **Backup e Recupera√ß√£o**
   - Rotina de backup autom√°tico dos dados

---

Essas melhorias s√£o recomendadas para tornar o sistema mais completo, seguro e pr√°tico para o dia a dia escolar.

---

# üí∞ An√°lise Completa do Sistema Financeiro

## üìä Situa√ß√£o Atual

### ‚úÖ Funcionalidades J√° Implementadas
- **Dados Financeiros B√°sicos do Aluno**:
  - `mensalidadeValor`: Valor da mensalidade
  - `descontoPercentual`: Percentual de desconto aplicado
  - `diaVencimento`: Dia do m√™s para vencimento (1-31)
  - `status`: Estado financeiro (`ativo`, `inadimplente`, `suspenso`)
  - `observacoes`: Campo livre para anota√ß√µes
  - C√°lculo autom√°tico do valor final com desconto

- **Valida√ß√µes Existentes**:
  - Dia de vencimento entre 1 e 31
  - Valor da mensalidade obrigat√≥rio
  - Status obrigat√≥rio
  - N√£o permite inativar aluno inadimplente

### ‚ùå Limita√ß√µes Atuais
- N√£o h√° gera√ß√£o de t√≠tulos/boletos
- N√£o h√° controle de pagamentos realizados
- N√£o h√° hist√≥rico financeiro
- N√£o h√° processo de matr√≠cula estruturado
- N√£o h√° controle de pr√©-matr√≠cula
- N√£o h√° relat√≥rios financeiros
- N√£o h√° integra√ß√£o com sistemas de pagamento

---

## üéØ Sistema Financeiro Completo - Especifica√ß√£o

### 1. üìã **Gest√£o de Matr√≠culas e Estados do Aluno**

#### 1.1 Estados do Aluno
```
PRE_MATRICULA -> MATRICULADO -> ATIVO/INADIMPLENTE/SUSPENSO -> INATIVO
```

- **PR√â-MATR√çCULA**: Aluno cadastrado mas n√£o matriculado efetivamente
- **MATRICULADO**: Matr√≠cula paga, aguardando in√≠cio das aulas
- **ATIVO**: Frequentando e em dia com pagamentos
- **INADIMPLENTE**: Com pend√™ncias financeiras
- **SUSPENSO**: Suspenso por inadimpl√™ncia ou disciplina
- **INATIVO**: Ex-aluno ou transferido

#### 1.2 Processo de Matr√≠cula
```
1. Cadastro inicial (PR√â-MATR√çCULA)
2. Gera√ß√£o de boleto de matr√≠cula
3. Confirma√ß√£o de pagamento ‚Üí MATRICULADO
4. In√≠cio das aulas ‚Üí ATIVO
```

### 2. üí≥ **Sistema de T√≠tulos e Cobran√ßa**

#### 2.1 Estrutura de T√≠tulo Financeiro
```javascript
titulo: {
  id: "string",                    // ID √∫nico
  alunoId: "string",              // Refer√™ncia ao aluno
  tipo: "matricula|mensalidade|taxa", // Tipo do t√≠tulo
  descricao: "string",            // Descri√ß√£o do t√≠tulo
  valorOriginal: "number",        // Valor sem desconto
  valorDesconto: "number",        // Valor do desconto
  valorFinal: "number",           // Valor final a pagar
  dataVencimento: "date",         // Data de vencimento
  dataGeracao: "date",            // Data de gera√ß√£o
  status: "pendente|pago|vencido|cancelado",
  formaPagamento: "boleto|pix|cartao|dinheiro",
  dataComprovante: "date",        // Data do comprovante
  observacoes: "string",
  
  // Controle de cobran√ßa
  tentativasCobranca: "number",
  ultimaCobranca: "date",
  proximaCobranca: "date",
  
  // Auditoria
  criadoPor: "string",
  atualizadoPor: "string",
  createdAt: "date",
  updatedAt: "date"
}
```

#### 2.2 Gera√ß√£o Autom√°tica de T√≠tulos
- **Matr√≠cula**: Gerada no momento do cadastro (PR√â-MATR√çCULA)
- **Mensalidades**: Geradas automaticamente no in√≠cio de cada m√™s
- **Taxas extras**: Material, uniforme, eventos, etc.

#### 2.3 Regras de Gera√ß√£o
```javascript
// Configura√ß√£o por per√≠odo escolar
configuracaoFinanceira: {
  periodoId: "string",
  valorMatricula: "number",
  valorMensalidade: "number",
  diaVencimentoPadrao: "number",
  descontoMatriculaAntecipada: "number",
  jurosAtraso: "number",
  multaAtraso: "number",
  diasParaSuspensao: "number",     // Ex: 30 dias
  diasParaCancelamento: "number"   // Ex: 90 dias
}
```

### 3. üìä **Dashboard Financeiro**

#### 3.1 Indicadores Principais
- **Receita Prevista vs Realizada** (mensal/anual)
- **Taxa de Inadimpl√™ncia** (% alunos com atraso)
- **Previs√£o de Recebimentos** (pr√≥ximos 30/60/90 dias)
- **Alunos por Status Financeiro**
- **M√©dia de Atraso** (dias em atraso)

#### 3.2 Relat√≥rios Financeiros
- **Relat√≥rio de Inadimpl√™ncia**
- **Fluxo de Caixa Projetado**
- **Relat√≥rio de Matr√≠culas** (per√≠odo)
- **An√°lise de Descontos Concedidos**
- **Hist√≥rico de Pagamentos por Aluno**

### 4. üîî **Sistema de Notifica√ß√µes e Cobran√ßa**

#### 4.1 Notifica√ß√µes Autom√°ticas
- **5 dias antes**: Lembrete de vencimento
- **No vencimento**: T√≠tulo vencendo hoje
- **3 dias ap√≥s**: Primeira cobran√ßa
- **15 dias ap√≥s**: Segunda cobran√ßa
- **30 dias ap√≥s**: Aviso de suspens√£o
- **45 dias ap√≥s**: Notifica√ß√£o de cancelamento

#### 4.2 Canais de Comunica√ß√£o
- 
- **Email autom√°tico - cadastrado**

- **Notifica√ß√£o no app**

### 5. üè¶ **Integra√ß√£o com Sistemas de Pagamento**

#### 5.1 M√©todos de Pagamento
- **PIX**: Gera√ß√£o autom√°tica de QR Code

- **Cart√£o de Cr√©dito**: Gateway de pagamento
- **Transfer√™ncia Banc√°ria**
- **Dinheiro**: Registro manual

#### 5.2 Reconcilia√ß√£o Autom√°tica
- **Webhook de confirma√ß√£o** de pagamentos
- **Baixa autom√°tica** de t√≠tulos pagos
- **Controle de diverg√™ncias**
- **Estorno** e cancelamentos

---

## üè¶ **Integra√ß√£o Banc√°ria e Gateways - Passo a Passo**

### üìã **Op√ß√µes de Integra√ß√£o Recomendadas**

#### ü•á **1. MERCADO PAGO (Recomendado para Come√ßar)**

**‚úÖ Vantagens:**
- API completa e bem documentada
- PIX, Cart√£o, Boleto em uma s√≥ integra√ß√£o
- Webhook nativo para confirma√ß√µes
- Ambiente sandbox para testes
- Taxa competitiva: 3,99% cart√£o + R$ 0,40
- Suporte brasileiro 24/7

**üìã Pr√©-requisitos:**
- [ ] **Conta Mercado Pago**: Criar conta empresarial
- [ ] **CNPJ da Escola**: Necess√°rio para conta empresarial
- [ ] **Conta Banc√°ria**: Para recebimento dos valores
- [ ] **Certificado SSL**: Obrigat√≥rio para webhooks

**üîß Implementa√ß√£o:**

**Passo 1: Configura√ß√£o da Conta**
```bash
# 1. Criar conta no Mercado Pago
https://www.mercadopago.com.br/developers

# 2. Verificar conta empresarial
- Enviar documentos do CNPJ
- Aguardar aprova√ß√£o (1-3 dias √∫teis)

# 3. Obter credenciais
- Access Token (Produ√ß√£o)
- Public Key (Frontend)
- Client ID e Client Secret
```

**Passo 2: Configura√ß√£o T√©cnica**
```javascript
// Instala√ß√£o SDK
npm install mercadopago

// Configura√ß√£o b√°sica
import { MercadoPagoConfig, Payment } from 'mercadopago';

const client = new MercadoPagoConfig({ 
  accessToken: 'YOUR_ACCESS_TOKEN',
  options: { timeout: 5000 }
});
```

**Passo 3: Criar Pagamento PIX**
```javascript
const createPixPayment = async (tituloData) => {
  const payment = new Payment(client);
  
  const body = {
    transaction_amount: tituloData.valor,
    description: tituloData.descricao,
    payment_method_id: 'pix',
    payer: {
      email: tituloData.email,
      first_name: tituloData.nome,
      identification: {
        type: 'CPF',
        number: tituloData.cpf
      }
    },
    notification_url: 'https://sua-escola.com/webhook/mercadopago'
  };
  
  const response = await payment.create({ body });
  return response;
};
```

**Passo 4: Webhook de Confirma√ß√£o**
```javascript
// Endpoint para receber notifica√ß√µes
app.post('/webhook/mercadopago', async (req, res) => {
  const { data, type } = req.body;
  
  if (type === 'payment') {
    const payment = await getPaymentById(data.id);
    
    if (payment.status === 'approved') {
      // Baixar t√≠tulo no sistema
      await baixarTitulo(payment.external_reference);
    }
  }
  
  res.status(200).send('OK');
});
```

#### ü•à **2. BANCO DO BRASIL / CAIXA (Boletos)**

**üìã Pr√©-requisitos:**
- [ ] **Conta Corrente Empresarial** no banco
- [ ] **Conv√™nio de Cobran√ßa** (negociar com gerente)
- [ ] **Certificado Digital A1** (para autentica√ß√£o API)
- [ ] **IP Fixo** (alguns bancos exigem)

**üí∞ Custos:**
- **Taxa de ades√£o**: R$ 200-500 (√∫nica)
- **Taxa mensal**: R$ 30-80
- **Por boleto**: R$ 0,30-0,80
- **Arquivo retorno**: R$ 5-15

**üîß Configura√ß√£o BB:**
```bash
# 1. Solicitar conv√™nio no gerente
- Conv√™nio de cobran√ßa registrada
- N√∫mero do conv√™nio (6-8 d√≠gitos)
- Carteira de cobran√ßa

# 2. Instalar certificado A1
- Baixar certificado do banco
- Instalar no servidor de aplica√ß√£o

# 3. Configurar API
- Endpoint: https://api.bb.com.br
- Client ID e Client Secret
- Scope: cobrancas.boletos
```

#### ü•â **3. PAGSEGURO / STONE**

**üìä Comparativo de Taxas:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ M√©todo          ‚îÇ Mercado  ‚îÇ PagSeguro‚îÇ Stone       ‚îÇ
‚îÇ                 ‚îÇ Pago     ‚îÇ          ‚îÇ             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ PIX             ‚îÇ 0,99%    ‚îÇ 0,99%    ‚îÇ 0,60%       ‚îÇ
‚îÇ Cart√£o D√©bito   ‚îÇ 2,99%    ‚îÇ 2,79%    ‚îÇ 1,50%       ‚îÇ
‚îÇ Cart√£o Cr√©dito  ‚îÇ 3,99%    ‚îÇ 4,99%    ‚îÇ 2,95%       ‚îÇ
‚îÇ Boleto          ‚îÇ R$ 3,49  ‚îÇ R$ 3,45  ‚îÇ R$ 2,90     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üöÄ **Roadmap de Implementa√ß√£o**

#### **Fase 1: Mercado Pago PIX (1 semana)**
```bash
Dia 1-2: 
- [x] Criar conta Mercado Pago
- [x] Verificar documentos
- [x] Obter credenciais de teste

Dia 3-4:
- [ ] Implementar SDK no projeto
- [ ] Criar endpoint de gera√ß√£o PIX
- [ ] Implementar webhook b√°sico

Dia 5-7:
- [ ] Testes em sandbox
- [ ] Integra√ß√£o com sistema de t√≠tulos
- [ ] Deploy em produ√ß√£o
```

#### **Fase 2: Cart√£o de Cr√©dito (1 semana)**
```bash
Dia 1-3:
- [ ] Implementar tokeniza√ß√£o de cart√£o
- [ ] Interface de captura segura
- [ ] Valida√ß√µes de seguran√ßa

Dia 4-7:
- [ ] Parcelamento autom√°tico
- [ ] Gest√£o de estornos
- [ ] Relat√≥rios de transa√ß√£o
```

#### **Fase 3: Boleto Banc√°rio (2 semanas)**
```bash
Semana 1:
- [ ] Negociar conv√™nio com banco
- [ ] Configurar certificado digital
- [ ] Implementar API de gera√ß√£o

Semana 2:
- [ ] Arquivo remessa autom√°tico
- [ ] Processamento de retorno
- [ ] Concilia√ß√£o banc√°ria
```

### üîí **Seguran√ßa e Compliance**

#### **Checklist de Seguran√ßa:**
- [ ] **HTTPS obrigat√≥rio** em todos os endpoints
- [ ] **Tokeniza√ß√£o** de dados sens√≠veis (cart√£o)
- [ ] **Valida√ß√£o** de webhooks (signature)
- [ ] **Rate limiting** nas APIs
- [ ] **Logs criptografados** de transa√ß√µes
- [ ] **Backup** de dados financeiros
- [ ] **Conformidade PCI-DSS** (para cart√µes)

#### **Vari√°veis de Ambiente:**
```bash
# .env (NUNCA commitar)
MERCADOPAGO_ACCESS_TOKEN=TEST-1234567890
MERCADOPAGO_PUBLIC_KEY=TEST-abcdef123456
MERCADOPAGO_WEBHOOK_SECRET=your-webhook-secret

# Banco
BANCO_CERTIFICADO_PATH=/path/to/cert.p12
BANCO_CERTIFICADO_PASSWORD=senha-certificado
BANCO_CONVENIO=1234567
```

### üìä **Monitoramento e M√©tricas**

#### **KPIs Essenciais:**
- **Taxa de convers√£o** por m√©todo de pagamento
- **Tempo m√©dio** de confirma√ß√£o
- **Taxa de estorno** por m√©todo
- **Custo efetivo** por transa√ß√£o
- **Disponibilidade** das APIs
- **Lat√™ncia** de webhooks

#### **Alertas Autom√°ticos:**
- üö® **Webhook fora do ar** > 5 minutos
- üö® **Taxa de falha** > 5%
- üö® **Transa√ß√£o suspeita** (valor alto)
- üö® **Limite de transa√ß√µes** atingido

### üí° **Dicas de Implementa√ß√£o**

#### **Melhores Pr√°ticas:**
1. **Come√ßar com Mercado Pago PIX** (mais simples)
2. **Implementar idempot√™ncia** (evitar duplica√ß√µes)
3. **Usar filas** para processamento ass√≠ncrono
4. **Cache de tokens** (renova√ß√£o autom√°tica)
5. **Retry autom√°tico** em falhas tempor√°rias
6. **Logs estruturados** para auditoria

#### **Armadilhas Comuns:**
- ‚ùå **N√£o validar webhooks** (seguran√ßa)
- ‚ùå **Processar webhook duas vezes** (duplica√ß√£o)
- ‚ùå **N√£o tratar timeout** de APIs
- ‚ùå **Hardcode de credenciais** no c√≥digo
- ‚ùå **N√£o testar cen√°rios de falha**

---

### 6. üì± **Interface do Sistema Financeiro**

#### 6.1 Tela Principal - Dashboard Financeiro
```
‚îå‚îÄ Dashboard Financeiro ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üí∞ Receita do M√™s    üìä Taxa Inadimpl√™ncia           ‚îÇ
‚îÇ R$ 45.000,00        ‚ö†Ô∏è  8,5%                        ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ üìà Pr√≥ximos Vencimentos   üîç Busca R√°pida           ‚îÇ
‚îÇ R$ 12.000,00 (15 t√≠tulos) [____________________]     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### 6.2 Gest√£o de T√≠tulos
```
‚îå‚îÄ T√≠tulos Financeiros ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Filtros: [Status‚ñº] [Tipo‚ñº] [Per√≠odo‚ñº] [üîç Buscar]   ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ ‚îå‚îÄ Jo√£o Silva - S001 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ ‚îÇ üí≥ Mensalidade Set/2025    üìÖ Venc: 10/09/2025 ‚îÇ  ‚îÇ
‚îÇ ‚îÇ R$ 800,00 ‚Üí R$ 720,00     ‚ö†Ô∏è  VENCIDO (5 dias) ‚îÇ  ‚îÇ
‚îÇ ‚îÇ [üí∞ Registrar Pagto] [üìß Cobrar] [üëÅÔ∏è Detalhes] ‚îÇ  ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### 6.3 Cadastro de Matr√≠cula
```
‚îå‚îÄ Nova Matr√≠cula ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1Ô∏è‚É£ Dados do Aluno                                   ‚îÇ
‚îÇ 2Ô∏è‚É£ Configura√ß√£o Financeira                         ‚îÇ
‚îÇ 3Ô∏è‚É£ Gera√ß√£o de T√≠tulo de Matr√≠cula                  ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ Status: PR√â-MATR√çCULA ‚Üí MATRICULADO                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 7. üîí **Seguran√ßa e Auditoria Financeira**

#### 7.1 Controles de Acesso
- **Coordenadora**: Acesso total ao financeiro
- **Secret√°ria Financeira**: Gest√£o de t√≠tulos e pagamentos
- **Professora**: Consulta limitada de status dos alunos
- **Pai/Respons√°vel**: Apenas seus pr√≥prios t√≠tulos

#### 7.2 Auditoria Obrigat√≥ria
- **Log de todas as opera√ß√µes** financeiras
- **Hist√≥rico de altera√ß√µes** em valores
- **Trilha de aprova√ß√µes** para descontos
- **Backup de comprovantes** de pagamento

### 8. üìã **Implementa√ß√£o - Fases**

#### Fase 1: Infraestrutura (2-3 semanas)
- [ ] Criar estrutura de dados para t√≠tulos
- [ ] Implementar estados do aluno
- [ ] Sistema b√°sico de gera√ß√£o de t√≠tulos
- [ ] Interface de gest√£o de t√≠tulos

#### Fase 2: Automa√ß√£o (2-3 semanas)
- [ ] Gera√ß√£o autom√°tica de mensalidades
- [ ] Sistema de notifica√ß√µes
- [ ] Dashboard financeiro
- [ ] Relat√≥rios b√°sicos

#### Fase 3: Integra√ß√£o (3-4 semanas)
- [ ] Integra√ß√£o PIX/Boletos
- [ ] Reconcilia√ß√£o autom√°tica
- [ ] WhatsApp Business
- [ ] Relat√≥rios avan√ßados

#### Fase 4: Otimiza√ß√£o (1-2 semanas)
- [ ] Interface mobile responsiva
- [ ] Performance e escalabilidade
- [ ] Testes de stress
- [ ] Documenta√ß√£o completa

### 9. üéØ **Crit√©rios de Aceite**

#### Funcionais
- ‚úÖ Aluno n√£o pode ser ativado sem pagar matr√≠cula
- ‚úÖ Mensalidades s√£o geradas automaticamente
- ‚úÖ Notifica√ß√µes s√£o enviadas conforme cronograma
- ‚úÖ Pagamentos s√£o baixados automaticamente
- ‚úÖ Relat√≥rios s√£o gerados em tempo real
- ‚úÖ Hist√≥rico financeiro √© preservado

#### T√©cnicos
- ‚úÖ Transa√ß√µes s√£o at√¥micas e consistentes
- ‚úÖ Dados financeiros s√£o criptografados
- ‚úÖ Backup autom√°tico di√°rio
- ‚úÖ Logs de auditoria completos
- ‚úÖ Performance < 2s para consultas
- ‚úÖ Disponibilidade > 99,5%

#### Seguran√ßa
- ‚úÖ Acesso por roles bem definidos
- ‚úÖ Dados sens√≠veis mascarados
- ‚úÖ Conformidade LGPD
- ‚úÖ Certificado SSL v√°lido
- ‚úÖ Autentica√ß√£o multifator (opcional)

---

## üéØ **PR√ìXIMOS PASSOS IMEDIATOS - ACTION PLAN**

### üìã **Semana 1: Prepara√ß√£o (Voc√™ precisa fazer)**

#### **üè¶ Definir Integra√ß√£o Banc√°ria**
- [ ] **Mercado Pago** (Recomendado): 
  - Acesse: https://www.mercadopago.com.br/developers
  - Criar conta empresarial com CNPJ
  - Solicitar verifica√ß√£o de conta
- [ ] **Alternativa - Banco Tradicional**:
  - Agendar reuni√£o com gerente do banco
  - Solicitar proposta de conv√™nio de cobran√ßa
  - Comparar taxas e prazos

#### **üìÑ Documenta√ß√£o Necess√°ria**
- [ ] **CNPJ** da escola (obrigat√≥rio)
- [ ] **Contrato Social** atualizado
- [ ] **Comprovante de Endere√ßo** da empresa
- [ ] **Conta Banc√°ria** empresarial ativa
- [ ] **Certificado SSL** v√°lido para o dom√≠nio

### üìã **Semana 2: Configura√ß√£o T√©cnica (Para Implementar)**

#### **üîß Preparar Ambiente**
```bash
# 1. Configurar vari√°veis de ambiente
MERCADOPAGO_ACCESS_TOKEN_SANDBOX=TEST-xxx
MERCADOPAGO_PUBLIC_KEY_SANDBOX=TEST-xxx
MERCADOPAGO_WEBHOOK_URL=https://sua-escola.com/webhook

# 2. Instalar depend√™ncias
npm install mercadopago
npm install express-rate-limit
npm install crypto
```

#### **üîó Endpoints Necess√°rios**
```javascript
// APIs que precisam ser criadas:
POST /api/financeiro/gerar-pix         // Gerar pagamento PIX
POST /api/financeiro/gerar-cartao      // Processar cart√£o
POST /webhook/mercadopago              // Receber confirma√ß√µes
GET  /api/financeiro/status/:id        // Consultar status
POST /api/financeiro/estorno/:id       // Processar estorno
```

### üìã **Semana 3-4: Implementa√ß√£o Base**

#### **üèóÔ∏è Estrutura de Dados**
```javascript
// Adicionar ao Firebase:
titulos_financeiros: {
  titulo_id: {
    alunoId: "string",
    tipo: "matricula|mensalidade|taxa",
    valorOriginal: 800.00,
    valorFinal: 720.00,
    dataVencimento: "2025-10-15",
    status: "pendente|pago|vencido",
    paymentId: "mp_payment_123",  // ID do Mercado Pago
    qrCode: "base64_qr_code",     // Para PIX
    linkPagamento: "https://...",  // Para cart√£o
    createdAt: "timestamp",
    updatedAt: "timestamp"
  }
}
```

#### **üé® Telas B√°sicas**
- [ ] **Dashboard Financeiro** (m√©tricas simples)
- [ ] **Lista de T√≠tulos** (filtros b√°sicos)
- [ ] **Gerar Pagamento** (PIX + Cart√£o)
- [ ] **Webhook Handler** (confirma√ß√£o autom√°tica)

### üìã **Cronograma Detalhado (30 dias)**

```
üìÖ Semana 1 (Dias 1-7): PREPARA√á√ÉO
‚îú‚îÄ‚îÄ Dia 1: Criar conta Mercado Pago
‚îú‚îÄ‚îÄ Dia 2: Enviar documentos verifica√ß√£o  
‚îú‚îÄ‚îÄ Dia 3: Configurar dom√≠nio SSL
‚îú‚îÄ‚îÄ Dia 4: Definir estrutura de dados
‚îú‚îÄ‚îÄ Dia 5: Instalar depend√™ncias
‚îú‚îÄ‚îÄ Dia 6-7: Estudar APIs Mercado Pago

üìÖ Semana 2 (Dias 8-14): BACKEND
‚îú‚îÄ‚îÄ Dia 8-9: Implementar servi√ßo PIX
‚îú‚îÄ‚îÄ Dia 10-11: Criar webhook handler
‚îú‚îÄ‚îÄ Dia 12-13: Sistema de t√≠tulos
‚îú‚îÄ‚îÄ Dia 14: Testes unit√°rios b√°sicos

üìÖ Semana 3 (Dias 15-21): FRONTEND  
‚îú‚îÄ‚îÄ Dia 15-16: Dashboard financeiro
‚îú‚îÄ‚îÄ Dia 17-18: Lista de t√≠tulos
‚îú‚îÄ‚îÄ Dia 19-20: Interface pagamento
‚îú‚îÄ‚îÄ Dia 21: Responsividade mobile

üìÖ Semana 4 (Dias 22-30): INTEGRA√á√ÉO
‚îú‚îÄ‚îÄ Dia 22-24: Testes sandbox completos
‚îú‚îÄ‚îÄ Dia 25-26: Deploy produ√ß√£o
‚îú‚îÄ‚îÄ Dia 27-28: Testes com valores reais
‚îú‚îÄ‚îÄ Dia 29-30: Ajustes e documenta√ß√£o
```

### üö® **ALERTAS IMPORTANTES**

#### **‚ö†Ô∏è Cuidados de Seguran√ßa**
```bash
# NUNCA fazer:
‚ùå Commitar tokens de produ√ß√£o no Git
‚ùå Processar dados de cart√£o no frontend  
‚ùå Ignorar valida√ß√£o de webhooks
‚ùå Usar HTTP (sempre HTTPS)

# SEMPRE fazer:
‚úÖ Usar vari√°veis de ambiente
‚úÖ Validar assinatura dos webhooks
‚úÖ Logs criptografados para auditoria
‚úÖ Rate limiting nas APIs p√∫blicas
```

#### **üí∞ Custos Estimados (Primeiro M√™s)**
```
Mercado Pago:
‚îú‚îÄ‚îÄ üìä Taxa por transa√ß√£o: 0,99% (PIX) - 3,99% (Cart√£o)
‚îú‚îÄ‚îÄ üì± Sem taxa de ades√£o ou mensalidade
‚îú‚îÄ‚îÄ üí≥ Antecipa√ß√£o autom√°tica em 14 dias
‚îî‚îÄ‚îÄ üéØ Estimativa: R$ 150-300 (baseado em 50 transa√ß√µes)

Banco Tradicional (se escolher):
‚îú‚îÄ‚îÄ üí∞ Taxa ades√£o: R$ 200-500
‚îú‚îÄ‚îÄ üìÖ Mensalidade: R$ 30-80  
‚îú‚îÄ‚îÄ üìÑ Por boleto: R$ 0,30-0,80
‚îî‚îÄ‚îÄ üéØ Estimativa: R$ 400-800 primeiro m√™s
```

### üìû **Contatos e Suporte**

#### **üÜò Se Precisar de Ajuda**
- **Mercado Pago**: https://www.mercadopago.com.br/developers/pt/support
- **Documenta√ß√£o**: https://www.mercadopago.com.br/developers/pt/docs
- **Sandbox**: https://www.mercadopago.com.br/developers/pt/guides/sdks
- **Status APIs**: https://status.mercadopago.com/

#### **üìö Material de Estudo**
- Guia PIX: https://www.mercadopago.com.br/developers/pt/docs/checkout-pro/integration-configuration/pix
- Webhooks: https://www.mercadopago.com.br/developers/pt/docs/notifications/webhooks
- Seguran√ßa: https://www.mercadopago.com.br/developers/pt/docs/security

---

## üí° **Observa√ß√µes Importantes**

### Impacto na Arquitetura Atual
- **Nova collection**: `titulos_financeiros`
- **Evolu√ß√£o**: Estrutura atual do `aluno.financeiro`
- **Adi√ß√£o**: Estados do aluno mais robustos
- **Integra√ß√£o**: APIs externas de pagamento

### Depend√™ncias Externas
- **WhatsApp Business API** (R$ 0,05 por mensagem)
- **Gateway de Pagamento** (2-4% por transa√ß√£o)
- **Banco para Boletos** (R$ 0,30-0,80 por boleto)
- **Certificado SSL** (se n√£o houver)

### ROI Estimado
- **Redu√ß√£o de inadimpl√™ncia**: 15-25%
- **Tempo de cobran√ßa manual**: -80%
- **Satisfa√ß√£o dos pais**: +30%
- **Tempo de reconcilia√ß√£o**: -90%

---

> **üìå Este sistema financeiro transformar√° a gest√£o escolar, automatizando processos manuais e melhorando significativamente o controle financeiro da institui√ß√£o.**

---

> Para gerar o PDF: abra este arquivo no VS Code, clique com o bot√£o direito e escolha "Export as PDF" ou use a op√ß√£o de imprimir para PDF.
